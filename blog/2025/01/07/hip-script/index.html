<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>HipScript - Ben Schattinger</title><meta name="gridsome:hash" content="2444d141b30d78a3cbc00240cc093b1342d97959"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" property="og:site_name" content="Ben Schattinger"><meta data-vue-tag="ssr" property="og:url" content="https://lights0123.com/blog/2025/01/07/hip-script/"><meta data-vue-tag="ssr" property="og:image" content="https://lights0123.com/favicon.png" data-key="og:image"><meta data-vue-tag="ssr" property="og:type" content="article" data-key="og:type"><meta data-vue-tag="ssr" property="og:title" content="HipScript"><meta data-vue-tag="ssr" name="description" content="By chaining several compilers, you can run CUDA code in the browser!"><meta data-vue-tag="ssr" property="og:description" content="By chaining several compilers, you can run CUDA code in the browser!" data-key="og:description"><meta data-vue-tag="ssr" property="article:author:first_name" content="Ben"><meta data-vue-tag="ssr" property="article:author:last_name" content="Schattinger"><meta data-vue-tag="ssr" property="article:published_time" content="2025-01-07T00:00:00.000Z"><meta data-vue-tag="ssr" property="article:modified_time" content="2025-01-07T00:00:00.000Z"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.4bccc38557c3841ee3c2a16e7276a78f.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.4bccc38557c3841ee3c2a16e7276a78f.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.4bccc38557c3841ee3c2a16e7276a78f.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.4bccc38557c3841ee3c2a16e7276a78f.png"><link rel="preload" href="/assets/css/0.styles.e5ce9e72.css" as="style"><link rel="preload" href="/assets/js/app.c4c6030a.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.b0ef1359.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--2021-schedule-vue.48eed297.js"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.053ada8c.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.5f0749d7.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-vue.cabe6c70.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.fb84e7a3.js"><link rel="prefetch" href="/assets/js/page--src--pages--n-link-vue.8d9d56ce.js"><link rel="prefetch" href="/assets/js/page--src--pages--privacy-vue.9f8790c2.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.bf0f3475.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--2021-schedule-vue.d485bb53.js"><link rel="stylesheet" href="/assets/css/0.styles.e5ce9e72.css"><script data-vue-tag="ssr" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://lights0123.com/blog/2025/01/07/hip-script/"},"headline":"HipScript","description":"By chaining several compilers, you can run CUDA code in the browser!","datePublished":"2025-01-07T00:00:00.000Z","dateModified":"2025-01-07T00:00:00.000Z","author":{"@type":"Person","name":"Ben Schattinger"}}</script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="h-full"><div class="flex flex-col h-full" data-v-926a7f80><header class="header"><nav class="p-2 bg-blue-500" data-v-70f7a70e><div class="container mx-auto flex items-center justify-between flex-wrap" data-v-70f7a70e><a href="/" class="flex items-center flex-shrink-0 text-ui-background mr-6 lg:mr-10 hide-if-active a" data-v-70f7a70e><span class="font-semibold text-3xl tracking-tight" data-v-70f7a70e>Ben Schattinger</span></a><div class="block lg:hidden" data-v-70f7a70e><button class="flex items-center px-3 py-2 border rounded text-blue-200 border-blue-400 hover:text-white hover:border-white" data-v-70f7a70e><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="fill-current h-3 w-3" data-v-70f7a70e><title data-v-70f7a70e>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" data-v-70f7a70e></path></svg></button></div><div class="w-full block flex-grow lg:items-center lg:w-auto hidden lg-flex-important" data-v-70f7a70e><div class="text-lg lg:flex-grow" data-v-70f7a70e><a href="/" class="block mt-4 lg:inline-block lg:mt-0 text-blue-200 hover:text-white mr-4 px-2 pb-1 active" data-v-70f7a70e>
					Home
				</a><a href="/about" class="block mt-4 lg:inline-block lg:mt-0 text-blue-200 hover:text-white mr-4 px-2 pb-1" data-v-70f7a70e>
					About
				</a><a href="/blog" class="block mt-4 lg:inline-block lg:mt-0 text-blue-200 hover:text-white mr-4 px-2 pb-1 active" data-v-70f7a70e>
					Blog
				</a></div></div><div class="hidden lg:flex text-ui-background mt-6 lg:mt-0" data-v-70f7a70e><a href="https://www.linkedin.com/in/ben-schattinger-9414b0220/" rel="noopener" target="_blank" title="LinkedIn" class="mr-4" data-v-70f7a70e><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-label="LinkedIn" class="feather feather-linkedin" data-v-70f7a70e data-v-70f7a70e><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z" data-v-70f7a70e data-v-70f7a70e></path><circle cx="4" cy="4" r="2" data-v-70f7a70e data-v-70f7a70e></circle></svg></a><a href="https://github.com/lights0123" rel="noopener" target="_blank" title="GitHub" data-v-70f7a70e><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-label="GitHub" class="feather feather-github" data-v-70f7a70e data-v-70f7a70e><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22" data-v-70f7a70e data-v-70f7a70e></path></svg></a><button aria-label="Enable Dark Theme" title="Enable Dark Theme" class="ml-6" data-v-68ce12ca data-v-70f7a70e><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-label="Enable Dark Theme" class="feather feather-sun" data-v-68ce12ca data-v-68ce12ca><circle cx="12" cy="12" r="5" data-v-68ce12ca data-v-68ce12ca></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" data-v-68ce12ca data-v-68ce12ca></path></svg></button></div></div></nav></header><main class="container mx-auto flex-grow px-2"><article class="flex flex-wrap items-start justify-start h-full" data-v-926a7f80><div class="on-this-page order-2 w-full md:w-1/3 sm:pl-4 md:pl-6 lg:pl-8 sticky top-0" data-v-926a7f80><div class="mt-8 sm:pl-4 md:pl-6 md:pt-12 lg:pl-8 sm:pb-16 sm:border-l border-ui-border md:mt-0" data-v-926a7f80><h3 class="pt-0 mt-0 text-sm tracking-wide uppercase border-none">On this page</h3><div><ul><li class="font-semibold depth-1"><a href="/blog/2025/01/07/hip-script/#what-is-hip-cuda" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
						What is HIP? CUDA?
					</a></li><li class="border-t border-dashed border-ui-border pt-2 mt-2 font-semibold depth-1"><a href="/blog/2025/01/07/hip-script/#supported-hipcuda-features" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
						Supported HIP/CUDA features
					</a></li><li class="depth-2"><a href="/blog/2025/01/07/hip-script/#unsupported-features" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1 pl-2"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
						Unsupported Features
					</a></li><li class="border-t border-dashed border-ui-border pt-2 mt-2 font-semibold depth-1"><a href="/blog/2025/01/07/hip-script/#how-its-built" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
						How it's built
					</a></li><li class="border-t border-dashed border-ui-border pt-2 mt-2 font-semibold depth-1"><a href="/blog/2025/01/07/hip-script/#issues-i-encountered" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
						Issues I encountered
					</a></li><li class="depth-2"><a href="/blog/2025/01/07/hip-script/#wasmer-runtime-workarounds" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1 pl-2"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
						Wasmer Runtime Workarounds
					</a></li><li class="depth-2"><a href="/blog/2025/01/07/hip-script/#compressed-data-on-cloudflare-r2" class="relative flex items-center py-1 text-sm transition transform hover:translate-x-1 pl-2"><span class="absolute w-2 h-2 -ml-3 rounded-full opacity-0 bg-ui-primary transition transform scale-0 origin-center"></span>
						Compressed Data on Cloudflare R2
					</a></li></ul></div></div></div><div class="order-1 w-full md:w-2/3" data-v-926a7f80><h1 class="text-5xl mb-2" data-v-926a7f80>HipScript</h1><p class="text-gray-600 text-sm mb-6" data-v-926a7f80><time datetime="2025-01-07T00:00:00.000Z" data-v-926a7f80>January 7, 2025</time><!---->
				· <i data-v-926a7f80>5 min read</i></p><div class="content mb-10" data-v-926a7f80><p data-v-926a7f80><p>By chaining <a href="https://github.com/CHIP-SPV/chipStar/" target="_blank" rel="nofollow noopener noreferrer">chipStar</a> (a HIP and NVIDIA® CUDA® to OpenCL compiler), <a href="https://github.com/google/clspv/" target="_blank" rel="nofollow noopener noreferrer">Clspv</a> (an OpenCL to Vulkan compiler), and <a href="https://dawn.googlesource.com/dawn/+/refs/heads/main/src/tint/" target="_blank" rel="nofollow noopener noreferrer">Tint</a> (among others, a Vulkan shader to WebGPU shader compiler), you can run CUDA code in the browser!</p>
<p><a href="https://hipscript.lights0123.com/" target="_blank" rel="noopener" class="xl:col-span-3 py-3 bg-gray-600 flex justify-center items-center text-white bg-gradient-cool font-bold text-3xl">Try it out! ↗</a></p>
<p><a href="https://github.com/lights0123/hipscript/" target="_blank" rel="noopener" class="xl:col-span-3 py-3 flex justify-center items-center text-white bg-gray-800 font-bold text-3xl">Source on GitHub ↗</a></p>
<div class="light-only">
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1555 404' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-59346f01fa87d36bcc950dc2e25ba123'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-59346f01fa87d36bcc950dc2e25ba123)' width='1555' height='404' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAARCAYAAABtu6qMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHu0lEQVRYw41XiY6jSBL1/39Pf0BrpV5NH1Vll8sX5jDYGLABgzE35Fu9qEqP%2b9DspBSKJI/IOF5EJhMAg1JqIP%2bV4jgegiAYfN8fNoYxOI4znM/nIUmS4XQ6/XFPXddDnudDlmVD13W/zXPseDyKHMoIw3CIokiI/ce1fd%2bLrMvlMlRV9dMc5VO/NE2Fc39ZljJHblmWjI3jeLeFdhwOBxnn%2baQJPlrf9zidTgjDUOjl5QWz2Qxt0yLLMjiOI9%2bu68lay7KwWq1gGAau1yuapkGe5zL%2b%2bvoqPAgC1HWN2%2b2GNE1Fxo8fP2Qt99i2LeS6LsZxxPF4lH2Xy0X2HQ4HrNdrLBYLWVOWpehC3biuqirsdjv4vi86sc%2b9lDOfz7HdbpEkyYfe72fQNs5zPWVNlFIKgEqSRMVxzE/VdZ0qikK5nqvmb3O1XC3VfPGmNoahZq8zGTMtU/VDr4IwUMbWUGEUKmfnKP/oK9fdqSRNZP9%2b7ynLNmXO23vq%2beVZZVmmkjhRpmkKWZalrterOh6Pcm4URWq9XivHcdTpdJLx3W6nbNuW9eScb5pGHQ4H5bqu6vtexvb7vVoul2qxWKjZbCbfT09PyvM8sbOua5HJ/u12U5N3%2byGeYwTZ9FhTNUiiFGVeYrPc4st//kJxuSFPrkLocSfVAqoDxlZBtQpDM8o36b6OrBpwjmLxPlFBYpTIi6LAv23Ul4glgsgpg6hhoyxGmgjquk7GzuczPM/D8/OzIJSo4Zp7ChCShKpuwzCiKwacghiO6eG4D7FebrFZmfB2B/j7AFvDlrFzlKCpWlRFjbps0FYdmrJFdatlrCoa1Ld36psBfTnez6GzNRGiv46z0TimEw2l42gMHcDUiKLoQ99BiNB%2bbJQRxzE2m42kE53CvVr2hBu4kYJ4AL/7ocfYjuiqHgoKTd%2bg6Rq0HzxJU%2bxcF5bjwNm5MC0b9m6Hnedha1mYLxbYbLdwXFfWuZ6HIAxxOp%2bR366CFjrM9VyJAiPDHNU1iI54dAwV5jzrBw1hDZhOp1JTGDgiV%2bc851mbSDSYdYGOYtTZ5zwdqtuEBYGHcpKK0BEcu6QZyqjB1S9RhjWqc4Py1KAr%2bg9IxQjD6CdvEzUlC5PrYbVmcSwA9TN0Z/NXxEGCrukRnSKBKA3W0WOk27b9DfJ0DqNHeBMB1PlxHQviox0stEwJFk5yElOMxDHO8%2bwJIUWv0MP0tGXZotg5OiNapojXOVL7imSb47zKxCEaWnRCXTeoWdWLAvO3Bbamhf3Bh2U7mM3fBB08nAe2bYfX%2bRzWxkZ8iuF5rpzNfGREGTE6n0rqmkT%2b6dMnmKYpKco5OktqVNPIPING4pyGNh2lU0bL4ZjmRAHPnTA/CB16jYcTOnESS6G6%2bFfkXilGX5wCl13xnhYfhzDSxtbE22KJl%2bkrXmaveHqe4sfzC96WKyxWa6zWG2yMrTjEMExcsgwYgcV8KUozcixkb29vElEqxiuO0aRuRASDQ2WpHznXPj09yVpGU9cO6kUncT1TQteP5XIp1zXPoQyiRBfSCQ%2biUBIhxs1ULDxGaIteok%2b6uAViI5cipotOkqS/QZWIsJ2dIOFPUJ69vmI1XyO/vOcuz2fk6XgqRIP5zfxm3uo5ndMcJzFo3EtdaSTTgn1GnAaz2rPROXQSHaNTgchhk1uASnABjd/v96JUUVzR1h26W486blHHndwIddK9v8NYA%2bJYipp2BtsxCMVwImOxXONtsUKW5xKZvh%2bkRiyWS7lK27rF6Xy679fVm8axaOnKT%2bjTEbriE%2baM4OONxb6%2bSukAoooO0ZWfnJEnUaZOGa6/X4Pvhv99Dw/tKHf2tb4iv%2bXIrhmu5VU4K7%2b338O0ban2PoWHAdz9Xm4Dcu9wkBvA5/V1PiNOkvstMJQjurpHkiaiCJVlvpIYBHKdZgwMDSCnkzhOB3AfUUtYM1WINhpOeixy3EPbaOyf2kTnD5XQ18OoRozyDuiRnC44HiL4XgDTcGCbLuIohe%2bF2JkePPuA6lqjK3u0t%2b5vXvXo60FoaAa5VlX//kBqrt0/PnKosL73qbi%2b6miofgOw0QmfP3%2bWcc7rYkcnMJjacPYZ/cerVdPksWoSPo8vwXFUuKYFmluL%2bXQpj56%2b7lFkN3nU4OPdwl8p%2bZ0a30l/02DS2CmpHXTKUI/ou%2bGuIOFLYtRoKJV/fMQwkr%2bSdhCj/%2b3bN0GNrmPMf8KeRY%2bFnWjR7wttl%2baCAP0vwPd5mqbSH8dRtU0r72j%2bH1yyi5rOpurLf78ow9jIG9r3fZVeUtW0jaqbWqi4FfKmL8tSlVWpqqoSzu9h5E/nKDwIAnnv53ku/wHT6fS%2bT/8D8P0fhqH8o1Av/a/Cdzy/%2bR9APbbbrdI2kCiTuvEMPUY6n8/3dY/r7zWAqcAUoMdYiL5%2b/Yrv37/LHG8Gy7SkELEan6KTRI1e5npGgvP0PvOVESHnOKPCa4195jFfcV//%2bvpTfj/%2bERLORMFjlP5futxT9%2bEp/RhpytNP5t9qAIBWKT5O0er%2bOI7SL4qi9X2/tSyrNU2zdV233Ww2rWEY7eFwaKuquu/7N6TlZlkmch3HEdm73U76HIvj%2bCdd/om4ZhgG2ReGYbvf70WWbdsiz/O8NggCoa7r2l9tJf0Pj6cVP53dkE0AAAAASUVORK5CYII=' /%3e%3c/svg%3e" width="1555" alt="foo" data-srcset="/assets/static/hipscript.82a2fbd.25bbe5d1d695cc44a24a0a4515000949.svg 480w, /assets/static/hipscript.cbab2cf.25bbe5d1d695cc44a24a0a4515000949.svg 1024w, /assets/static/hipscript.a72e906.25bbe5d1d695cc44a24a0a4515000949.svg 1555w" data-sizes="(max-width: 1555px) 100vw, 1555px" data-src="/assets/static/hipscript.a72e906.25bbe5d1d695cc44a24a0a4515000949.svg"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/hipscript.a72e906.25bbe5d1d695cc44a24a0a4515000949.svg" width="1555" alt="foo"></noscript></p>
</div>
<div class="dark-only">
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1555 404' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-b29a5aaa3afb700c1784b72fd5a80b0f'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-b29a5aaa3afb700c1784b72fd5a80b0f)' width='1555' height='404' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAARCAYAAABtu6qMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAIzUlEQVRYw5VYWYwcZxHunWPn2rmvnumu6p57Zufc6WPn77F3ZhfjI74EcYwTx46NIjmyg7mCOYTCAzEQWZGAgCB2pMjE4CgGgWIH4kQYFCAKLyABQclDHnhEiDxECIkjavTPVtvtzSJCS%2bXp7vr7d9VXVV/Vv4IgCAIACJtdAJAFxCIAyIjYQsQKAOQQMQ0A%2bf/yTRAA4iT%2bTfQ%2bACgiYhYR84hYQESR7wcAhQ1rvQAQA4AkAIQ36BIAkEHEFCJmAEB01gBABABqtKeH3mXID6C1We7LTefJsJkRAFgAABMB9RrWAyqWEiDJ3HldQaVUx6YPUakjYhcRF1VUY2WsBFRU4whYR8AhglJXQJHKWA2WsLygoppWUKkiKqyMlSA5xo2sAkAJET3cQHqXIiC5tW0A6PE15BgHwwSAOgCEAIDbBQRWmfR8nyUAaJLjGuk86/7N9NzfhBsAHtVMSSkJMkh%2bFUvRIhTUvJzr56VsByrKQCrJLVHKDQsgDkQ5XxNEwZuTMwUR8s2snBbzcq6clTNSXs6VElIslZOzalZOY07O1nJyhutQlHNGUorFFVQy5ESDO42IMTIsShHqEDg8KBI5UKX1VQImQM6XCIA2gdYFgD45zp9HAKC6MjRP9wtuADhyMX7/65W/zN7d2TwSuqt1vHgfPBBfG%2b4drhh37DnWeDB1uH4ic6R5Mmuv2D57zfbZE9v/5lZ7/u9Te/71Lf%2bef2PrO/M3Rm8G/za1/f9atf32%2b2y/vc2elcNF86XwtLqjkJXTcQVVnr5pKqnUzKD3eJG9OQIjR5EOki5FkebO%2b26WM4BK2TMk4AruDTnyEef5/t5D3heWX4vfPT6l7Lbu6ey37qtstw4Y26wPajvGBxu7xoeqq6N9/Snbp%2b0ZHZY%2bbj4Svt88E3vQ/MLCp41z4U%2bZjy6cND8fPWU%2bHPuo%2bcXYQ8aXo5/Qz0a/MbwSvD5%2b/aajq%2bWdgizLAiJymXPZ4w4Od65I2ZAgZ5JUGiKt8ZD4NgDlOL9IGcIvDvwtUkJEL6Vdrq40fUJQ8FwfvxH4tv6jdeJhgl8Yz8TH79vMzPaZVRuwcbPPxo0BGy/2Z/dWdcDG7QHbYvbZuNtnVr3HrFrPYtWONZJ7jBUK22qxv67YgZPdz4Xzck5FVAoUGfUWB8EcN5AbL0mSE22e5owcMTgfUfSjRLgDqvlFKp8OOVymchjSPden3QhJnIlJqSioiEUoSMOSmbo8ell%2b0nhevWTckL9r/Ey8ZNwoXDFeifPvDLZa0Nmq7EZ7he32mGwtorNpTWfTJYOtxu2OfVvqVpoN/UDjqPTJ3iOBnJzNl7Dsl2V5zokeRXp%2bk5TPU0qnKKIFd5chQnT8UIkfeL2H6Zc/LxBgYXr2Oe2kRQgnEbCWl3N5vczEx/Ur2pPmjwfnjaut88bV7nnj6vAJ47kZmewaHRI0NhU1NglpbBLU2CSusYmpsUlHY5OyxiaLGpuMNDZp8zVLy1uC23YcDFQXW7pVnrSNsiUWZFFFwEVKS50iJpGRSYos/72TEyYiRkjntLYA6UWSaKfTEVw8wNtsnCRJLTNJnMNFduqrSahJCNjJSum0VZmIZ5fOK0%2bZ16sXjGvqBeNaY12ej9y1fGL2n2hsUtfYpKexiaGxyZhkhUTXrKmmsclQY5M%2bB0Rn056xc3vGvsf2LKrdJQ60gmqIWh9P03kyrEbRdGq/RCBJ9MvTfZn0YQeQfr/vzAB8/ZKLP3rkY5X2qDhEKrj6Ir8QAUvrGTCSL5ovxp4wnmuR1M8bV3vnzKcD/OPJaK9XY5PcxlSljGhSJgQ26kuNqj4qrwyn1R3JtJSM4frM0abWlSQD29Tfh3TvrukKOdIk2/MEWo6yIEF7LbvIMUzAhJxyIJ3I/%2bHpEab6QgXVWEKKLZxonwldWr4RvaL/Kvd9/dX8T/Tfx67or%2bTsge3lH5tsTeQ8QLXvJV5AnU27OpvWdTbVdDY1DLaaunf0EYGZ7/ceuOOkt9ZpDx5onUl9uP2xUF7OzgDkQxAnYjKqShFLU/QbNNT0nTSnOl9w1X%2bE1vMUTyBiaAPz8ymWcx2fBIuuyTPlJpm4e9Nn2C/nn9Z/Gha2COGYlY1lmBwXLN%2bCyloJzvw9xip9Zi32mdXrWkzpshHM3lkW11V7jJVnHYAx7FqjQoeNcgM2FsVt1dir7M%2bRLw0vhJJSjE%2bHIh%2bLKYIO0eVdLRCJo5CDpKqqQACIlLVVGonnueMkEUQMIKKfOlz8NubfwK5zrkFhfVFKEE73H/ZcNl6O3Ts%2bLe22Dpf3WkdqO60P9XdZh7p3j0/JH7CO1/aMDnf2j462PmM%2blvim/oPIY8al6Nf0ZyJf1S8vfF1/NnJJvxF6Sn8h9D3t58EXtT/O/0Z7y/fs4BfBC%2ba1%2bP8YcuJO3yfiihGRZZwZwElhANhOdR5zkWbY1R5TdM/L3Jk3bs0ZG0bh9RZXtmbvzhnf8RxvnE5/tng2sqrvtdb0fdpXUo8HDlaPJY6VTkXsoT0D762p7f3Tmu2199se%2b5DteWe77X17u%2b39w%2bo/fK%2bt/tP/2%2bnb/oujl4LfMn8Yvrrld6Gji6d8GTm1oKAap9YUIeFOhDYMMYFNxAGIR39MWeLwWJf4okXEXnbmC2f4ue3w5wIg4dREEQpzKpbmJZAwJScySTmekFVZl1CaFkBsxWEhIkJezkImGQDvfKjoD3Dh3JGSEtFoMRzmEi4GQpF1CQthYX3KmxPmilAsIioi4Mxhfh7QKcphF9FJFOEMRTFN0c/T8zyB1nA7RODwq/iuk%2b0tXzcFwEOLKojI29BWANwyIylQyiBDAwEHCNhDUAoKqlHew/kRma9HRK7v8zaKgLy/t2cnQ1R4Z2kgKjUFFQUR%2bSlzRQaJDz8KOcxBKMuy7CUuiDil%2bR7PBFnHhw06D6V72Jn73SP2u0BwLZhznQ/oiIp1ACxRajUJ5ZDwf1yufRO0r3PCK1HU%2bbuMs15RlJsGbyauwMmuw0%2bZ9qoQwAUqF99mf/v4D3%2bgO6v6e2S/AAAAAElFTkSuQmCC' /%3e%3c/svg%3e" width="1555" alt="foo" data-srcset="/assets/static/hipscript.dark.82a2fbd.4b8b9933739c7717f269ee90e2eb2fff.svg 480w, /assets/static/hipscript.dark.cbab2cf.4b8b9933739c7717f269ee90e2eb2fff.svg 1024w, /assets/static/hipscript.dark.a72e906.4b8b9933739c7717f269ee90e2eb2fff.svg 1555w" data-sizes="(max-width: 1555px) 100vw, 1555px" data-src="/assets/static/hipscript.dark.a72e906.4b8b9933739c7717f269ee90e2eb2fff.svg"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/hipscript.dark.a72e906.4b8b9933739c7717f269ee90e2eb2fff.svg" width="1555" alt="foo"></noscript></p>
</div>
<h1 id="what-is-hip-cuda"><a href="#what-is-hip-cuda" aria-hidden="true"><span class="icon icon-link"></span></a>What is HIP? CUDA?</h1>
<p>CUDA is the name of the API developed by NVIDIA for GPGPU (General-purpose computing on graphics processing units). A CUDA compiler compiles the same C++ file twice: once for the GPU architecture, and once for the host. This way, you can share code between them, and all data types remain the same. CUDA also provides library functions for interacting with the GPU and special syntax for launching CUDA kernels.</p>
<p>CUDA kernels are written for one thread, but are then executed by many. Several threads (of the programmer's choice) form a "block", which can share access to fast on-chip memory. There are then some number of blocks in a "grid".</p>
<p>AMD came along and created HIP, their competitor to CUDA. It has identical syntax and concepts to CUDA—just pretty much does <code class="language-text">sed s/cuda/hip/g</code>! This allows projects like chipStar, which allows HIP code to run on any OpenCL-supported device, to provide a header file that <code class="language-text">#define</code>s CUDA calls into HIP ones.</p>
<h1 id="supported-hipcuda-features"><a href="#supported-hipcuda-features" aria-hidden="true"><span class="icon icon-link"></span></a>Supported HIP/CUDA features</h1>
<p>This project currently supports a <strong>very basic</strong> subset of HIP and CUDA. However, the supported subset already provides a fair bit of material for learning GPU programming:</p>
<ul>
<li>
<p>Basic kernel launch syntax</p>
<ul>
<li>C++ is fully supported, so use generic kernels as you please! The compiler will analyze calls from the CPU side to determine what functions must be generated.</li>
</ul>
</li>
<li>Static and dynamic shared memory</li>
<li><code class="language-text">__syncthreads</code> (as long as it's in a uniform control flow path, i.e. no early returns or if statements based on <code class="language-text">threadIdx</code>)</li>
<li><code class="language-text">printf</code> (format string and values are written to a hidden buffer by the GPU, then formatted by the CPU afterwards)</li>
<li><code class="language-text">assert</code> (although Tint doesn't allow <code class="language-text">__syncthreads</code> afterwards due to <a href="https://github.com/gpuweb/gpuweb/issues/3479#issuecomment-1467271026" target="_blank" rel="nofollow noopener noreferrer">an overzealous control-flow checker</a>)</li>
<li>
<p><code class="language-text">hipMalloc</code>, <code class="language-text">hipFree</code>, <code class="language-text">hipMemcpy</code>, <code class="language-text">hipGetSymbolAddress</code>, <code class="language-text">hipMemcpyToSymbol</code>, <code class="language-text">hipLaunchKernel</code>, <code class="language-text">hipLaunchKernelGGL</code>, <code class="language-text">hipGetLastError</code>, <code class="language-text">hipPeekAtLastError</code>, <code class="language-text">hipGetErrorName</code>, <code class="language-text">hipGetErrorString</code></p>
<ul>
<li>and corresponding CUDA functions</li>
</ul>
</li>
<li><code class="language-text">__device__</code> and <code class="language-text">__constant__</code> variables (although the latter are treated the same as the former, i.e. read-write)</li>
</ul>
<h2 id="unsupported-features"><a href="#unsupported-features" aria-hidden="true"><span class="icon icon-link"></span></a>Unsupported Features</h2>
<ul>
<li>
<p>any functions not listed above</p>
<ul>
<li>streams</li>
<li>graphs</li>
<li>managed/asynchronous memory transfers</li>
</ul>
</li>
<li>64-bit floating point (WebGPU limitation) and 16-bit floating point (Tint limitation) numbers</li>
<li>integers other than 32-bit signed and unsigned integers (WebGPU limitation)</li>
<li>
<p>many things with pointers:</p>
<ul>
<li>passing a pointer to a kernel not directly as a parameter (e.g. in a struct)</li>
<li>
<p><strong>pointer manipulation on the CPU side</strong>: note this means that you cannot pass an offset to <code class="language-text">hipMemcpy</code> or a kernel</p>
<ul>
<li>WebGPU would allow a 128-byte aligned offset passed to a kernel. However, I decided not to implement that because of the limited 32-bit address space of WASM.</li>
</ul>
</li>
</ul>
</li>
<li>warp intrinsics (should be possible, although currently requires experimental Chrome flags)</li>
<li>dynamic parallelism (could be polyfilled by converting calls to writes in a buffer, then launching kernels from the CPU)</li>
<li>any GPU libraries: cuDNN, cuBLAS, cuRAND, ...</li>
<li>Cooperative Groups</li>
<li>Inline PTX (<a href="https://github.com/CHIP-SPV/chipStar/discussions/904#discussioncomment-10255598" target="_blank" rel="nofollow noopener noreferrer">although it has been done before</a>)</li>
</ul>
<h1 id="how-its-built"><a href="#how-its-built" aria-hidden="true"><span class="icon icon-link"></span></a>How it's built</h1>
<p>Using LLVM compiled to WebAssembly, the input source code is first passed through Clang, which already understands HIP and CUDA. These languages are compiled in two passes—for the GPU using SPIR-V and for the CPU using WebAssembly. These use WebAssembly headers, meaning all types are the same size. Then, the GPU side code is fed through chipStar, a HIP-to-OpenCL translator. I keep its output as LLVM bitcode to immediately pass through Clspv, converting it to a Vulkan shader. Finally, Google's Tint from the Dawn project translates it to WGSL. A WebAssembly implementation of the HIP API then coordinates kernel launches.</p>
<p>I aimed to keep file size in mind. To package as large of a project LLVM is, I wanted to make sure I wasn't duplicating any code—for example, the WASM backend code shouldn't exist separately in the compiler and linker. This is traditionally done with dynamic linking, which isn't supported by Wasmer (it is by Emscripten, but by going through a JS intermediate: slow). Thankfully, LLVM has an option just for this case: <code class="language-text">LLVM_TOOL_LLVM_DRIVER_BUILD</code>. By setting this flag, LLVM creates a single entrypoint that statically links to every executable. This way, you can just pass the desired tool as arg0 or arg1, like <code class="language-text">llvm clang++ file.cpp</code>.</p>
<p>I then bundled the chipStar LLVM passes in the LLVM source code. I added a command-line flag that allows Clang to run the passes. Typically they're run with <code class="language-text">opt</code>, but that isn't compatible with the driver. Clspv and SPIRV-Tools were added as <code class="language-text">LLVM_EXTERNAL_PROJECTS</code> to be additionally integrated in the single tool.</p>
<h1 id="issues-i-encountered"><a href="#issues-i-encountered" aria-hidden="true"><span class="icon icon-link"></span></a>Issues I encountered</h1>
<h2 id="wasmer-runtime-workarounds"><a href="#wasmer-runtime-workarounds" aria-hidden="true"><span class="icon icon-link"></span></a>Wasmer Runtime Workarounds</h2>
<p>I compiled LLVM using the WASIX toolchain, because it offers much needed functions not available in vanilla WASI, and Emscripten doesn't feel great for porting traditional command-line applications. However, the Wasmer SDK is the only implementation of the WASIX specification, and the JS version has some bugs. <a href="https://github.com/wasmerio/wasmer-js/issues/407" target="_blank" rel="nofollow noopener noreferrer">You can't load a WASM file directly</a>, loading their "webc" container directly just failed with a generic <code class="language-text">Unreachable</code> error, and the recommended Wasmer CDN doesn't compress files—even when a 5x compression ratio is possible. This large file size then causes Chrome to not cache anything at all! So, I set the "API endpoint" of the CDN to a simple <code class="language-text">file:</code> URI that points to a <code class="language-text">blob:</code> URI for the actual WASM file. On the page load, I handle downloading and caching the binary manually.</p>
<p>Then, I was running into issues where I'd get another generic <code class="language-text">Unreachable</code> after launching more than a couple programs. I worked around this by just spawning new Web Workers and completely re-loading the SDK in each. Very thankfully, it seems like Chrome caches <code class="language-text">WebAssembly.compile</code> calls with the same binary input so there isn't too much of a performance penalty.</p>
<p>I couldn't debug these issues because <a href="https://github.com/wasmerio/wasmer-js/issues/437" target="_blank" rel="nofollow noopener noreferrer">the Wasmer SDK source is currently unable to be built</a> and the package on NPM doesn't ship with debug symbols.</p>
<h2 id="compressed-data-on-cloudflare-r2"><a href="#compressed-data-on-cloudflare-r2" aria-hidden="true"><span class="icon icon-link"></span></a>Compressed Data on Cloudflare R2</h2>
<p>GZip compression brought by LLVM bundle from 75MB to 21MB, and Brotli further to 15MB. I decided to use Brotli because of these savings, and it's supported on all modern browsers. I decided to use Cloudflare R2 as my storage provider, on which <a href="https://alexi.sh/blog/2023/03/using-r2-to-store-and-serve-compressed-content/" target="_blank" rel="nofollow noopener noreferrer">others have had success uploading pre-compressed data to</a> since it won't compress to Brotli for you. However, I was encountering issues with the upload step, since rclone was detecting an incorrectly-sized upload. Turns out, you need to specify <code class="language-text">Cache-Control: no-transform</code>. That has the bonus of correctly supporting custom domains with R2 (strongly encouraged for production), since it tells Cloudflare not to uncompress the data, bypassing the entire purpose of doing this.</p>
<div class="gridsome-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">rclone copyto --progress --header-upload "Content-Type: application/octet-stream" --header-upload "Content-Encoding: br" --header-upload "Cache-Control: no-transform" $file $connection:$bucket/$serverpath</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Before I discovered that, I used gdb to set a breakpoint on <code class="language-text">github.com/rclone/rclone/fs/operations.(*copy).removeFailedCopy</code> to stop deleting the (sucessfully, but it didn't know that) uploaded file.</p>
</p></div><div class="comments" style="height:0px;" data-v-926a7f80><iframe title="Comments" scrolling="no" src="https://utteranc.es/utterances.html?issue-term=title&amp;url=https%3A%2F%2Flights0123.com%2Fblog%2F2025%2F01%2F07%2Fhip-script%2F&amp;title=HipScript&amp;repo=lights0123%2Flights0123.github.io&amp;theme=github-light&amp;label=comments&amp;origin=https%3A%2F%2Flights0123.com"></iframe></div></div></article></main><footer class="bg-ui-sidebar p-8 mt-6" data-v-613304c8><div class="container mx-auto grid md:grid-cols-2 md:gap-4" data-v-613304c8><div data-v-613304c8>
			© 2025 Ben Schattinger <a href="/privacy" class="border-b border-ui-blockquote ml-2" data-v-613304c8>Privacy</a></div><div data-v-613304c8>Suggestions? <a rel="noopener" target="_blank" href="https://github.com/lights0123/lights0123.github.io/issues/new" class="border-b-2 text-ui-emph border-ui-border hover:border-ui-primary" data-v-613304c8>Submit an issue</a></div></div></footer></div><div><noscript><p><img src="&#x2F;&#x2F;matomo.lights0123.com&#x2F;matomo.php?idsite=1&amp;rec=1&url=https%3A%2F%2Flights0123.com%2Fblog%2F2025%2F01%2F07%2Fhip-script%2F" style="border:0;" alt="" /></p></noscript></div></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"id":"757854843a4e697a7f6d7e276735e562","title":"HipScript","description":"By chaining several compilers, you can run CUDA code in the browser!","content":"\u003Cp\u003EBy chaining \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FCHIP-SPV\u002FchipStar\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EchipStar\u003C\u002Fa\u003E (a HIP and NVIDIA® CUDA® to OpenCL compiler), \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgoogle\u002Fclspv\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EClspv\u003C\u002Fa\u003E (an OpenCL to Vulkan compiler), and \u003Ca href=\"https:\u002F\u002Fdawn.googlesource.com\u002Fdawn\u002F+\u002Frefs\u002Fheads\u002Fmain\u002Fsrc\u002Ftint\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ETint\u003C\u002Fa\u003E (among others, a Vulkan shader to WebGPU shader compiler), you can run CUDA code in the browser!\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhipscript.lights0123.com\u002F\" target=\"_blank\" rel=\"noopener\" class=\"xl:col-span-3 py-3 bg-gray-600 flex justify-center items-center text-white bg-gradient-cool font-bold text-3xl\"\u003ETry it out! ↗\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Flights0123\u002Fhipscript\u002F\" target=\"_blank\" rel=\"noopener\" class=\"xl:col-span-3 py-3 flex justify-center items-center text-white bg-gray-800 font-bold text-3xl\"\u003ESource on GitHub ↗\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cdiv class=\"light-only\"\u003E\n\u003Cp\u003E\u003Cimg class=\"g-image g-image--lazy g-image--loading\" src=\"data:image\u002Fsvg+xml,%3csvg fill='none' viewBox='0 0 1555 404' xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg' xmlns:xlink='http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-59346f01fa87d36bcc950dc2e25ba123'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'\u002F%3e%3c\u002Ffilter%3e%3c\u002Fdefs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-59346f01fa87d36bcc950dc2e25ba123)' width='1555' height='404' xlink:href='data:image\u002Fsvg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAARCAYAAABtu6qMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHu0lEQVRYw41XiY6jSBL1\u002F39Pf0BrpV5NH1Vll8sX5jDYGLABgzE35Fu9qEqP%2b9DspBSKJI\u002FIOF5EJhMAg1JqIP%2bV4jgegiAYfN8fNoYxOI4znM\u002FnIUmS4XQ6\u002FXFPXddDnudDlmVD13W\u002FzXPseDyKHMoIw3CIokiI\u002Fce1fd%2bLrMvlMlRV9dMc5VO\u002FNE2Fc39ZljJHblmWjI3jeLeFdhwOBxnn%2baQJPlrf9zidTgjDUOjl5QWz2Qxt0yLLMjiOI9%2bu68lay7KwWq1gGAau1yuapkGe5zL%2b%2bvoqPAgC1HWN2%2b2GNE1Fxo8fP2Qt99i2LeS6LsZxxPF4lH2Xy0X2HQ4HrNdrLBYLWVOWpehC3biuqirsdjv4vi86sc%2b9lDOfz7HdbpEkyYfe72fQNs5zPWVNlFIKgEqSRMVxzE\u002FVdZ0qikK5nqvmb3O1XC3VfPGmNoahZq8zGTMtU\u002FVDr4IwUMbWUGEUKmfnKP\u002FoK9fdqSRNZP9%2b7ynLNmXO23vq%2beVZZVmmkjhRpmkKWZalrterOh6Pcm4URWq9XivHcdTpdJLx3W6nbNuW9eScb5pGHQ4H5bqu6vtexvb7vVoul2qxWKjZbCbfT09PyvM8sbOua5HJ\u002Fu12U5N3%2byGeYwTZ9FhTNUiiFGVeYrPc4st\u002F\u002FkJxuSFPrkLocSfVAqoDxlZBtQpDM8o36b6OrBpwjmLxPlFBYpTIi6LAv23Ul4glgsgpg6hhoyxGmgjquk7GzuczPM\u002FD8\u002FOzIJSo4Zp7ChCShKpuwzCiKwacghiO6eG4D7FebrFZmfB2B\u002Fj7AFvDlrFzlKCpWlRFjbps0FYdmrJFdatlrCoa1Ld36psBfTnez6GzNRGiv46z0TimEw2l42gMHcDUiKLoQ99BiNB%2bbJQRxzE2m42kE53CvVr2hBu4kYJ4AL\u002F7ocfYjuiqHgoKTd%2bg6Rq0HzxJU%2bxcF5bjwNm5MC0b9m6Hnedha1mYLxbYbLdwXFfWuZ6HIAxxOp%2bR366CFjrM9VyJAiPDHNU1iI54dAwV5jzrBw1hDZhOp1JTGDgiV%2bc851mbSDSYdYGOYtTZ5zwdqtuEBYGHcpKK0BEcu6QZyqjB1S9RhjWqc4Py1KAr%2bg9IxQjD6CdvEzUlC5PrYbVmcSwA9TN0Z\u002FNXxEGCrukRnSKBKA3W0WOk27b9DfJ0DqNHeBMB1PlxHQviox0stEwJFk5yElOMxDHO8%2bwJIUWv0MP0tGXZotg5OiNapojXOVL7imSb47zKxCEaWnRCXTeoWdWLAvO3Bbamhf3Bh2U7mM3fBB08nAe2bYfX%2bRzWxkZ8iuF5rpzNfGREGTE6n0rqmkT%2b6dMnmKYpKco5OktqVNPIPING4pyGNh2lU0bL4ZjmRAHPnTA\u002FCB16jYcTOnESS6G6%2bFfkXilGX5wCl13xnhYfhzDSxtbE22KJl%2bkrXmaveHqe4sfzC96WKyxWa6zWG2yMrTjEMExcsgwYgcV8KUozcixkb29vElEqxiuO0aRuRASDQ2WpHznXPj09yVpGU9cO6kUncT1TQteP5XIp1zXPoQyiRBfSCQ%2biUBIhxs1ULDxGaIteok%2b6uAViI5cipotOkqS\u002FQZWIsJ2dIOFPUJ69vmI1XyO\u002FvOcuz2fk6XgqRIP5zfxm3uo5ndMcJzFo3EtdaSTTgn1GnAaz2rPROXQSHaNTgchhk1uASnABjd\u002Fv96JUUVzR1h26W486blHHndwIddK9v8NYA%2bJYipp2BtsxCMVwImOxXONtsUKW5xKZvh%2bkRiyWS7lK27rF6Xy679fVm8axaOnKT%2bjTEbriE%2baM4OONxb6%2bSukAoooO0ZWfnJEnUaZOGa6\u002FX4Pvhv99Dw\u002FtKHf2tb4iv%2bXIrhmu5VU4K7%2b338O0ban2PoWHAdz9Xm4Dcu9wkBvA5\u002FV1PiNOkvstMJQjurpHkiaiCJVlvpIYBHKdZgwMDSCnkzhOB3AfUUtYM1WINhpOeixy3EPbaOyf2kTnD5XQ18OoRozyDuiRnC44HiL4XgDTcGCbLuIohe%2bF2JkePPuA6lqjK3u0t%2b5vXvXo60FoaAa5VlX\u002F\u002FkBqrt0\u002FPnKosL73qbi%2b6miofgOw0QmfP3%2bWcc7rYkcnMJjacPYZ\u002FcerVdPksWoSPo8vwXFUuKYFmluL%2bXQpj56%2b7lFkN3nU4OPdwl8p%2bZ0a30l\u002F02DS2CmpHXTKUI\u002Fou%2bGuIOFLYtRoKJV\u002FfMQwkr%2bSdhCj\u002F%2b3bN0GNrmPMf8KeRY%2bFnWjR7wttl%2baCAP0vwPd5mqbSH8dRtU0r72j%2bH1yyi5rOpurLf78ow9jIG9r3fZVeUtW0jaqbWqi4FfKmL8tSlVWpqqoSzu9h5E\u002FnKDwIAnnv53ku\u002FwHT6fS%2bT\u002F8D8P0fhqH8o1Av\u002Fa\u002FCdzy\u002F%2bR9APbbbrdI2kCiTuvEMPUY6n8\u002F3dY\u002Fr7zWAqcAUoMdYiL5%2b\u002FYrv37\u002FLHG8Gy7SkELEan6KTRI1e5npGgvP0PvOVESHnOKPCa4195jFfcV\u002F\u002F%2bvpTfj\u002F%2bERLORMFjlP5futxT9%2bEp\u002FRhpytNP5t9qAIBWKT5O0er%2bOI7SL4qi9X2\u002FtSyrNU2zdV233Ww2rWEY7eFwaKuquu\u002F7N6TlZlkmch3HEdm73U76HIvj%2bCdd\u002Fom4ZhgG2ReGYbvf70WWbdsiz\u002FO8NggCoa7r2l9tJf0Pj6cVP53dkE0AAAAASUVORK5CYII=' \u002F%3e%3c\u002Fsvg%3e\" width=\"1555\" alt=\"foo\" data-srcset=\"\u002Fassets\u002Fstatic\u002Fhipscript.82a2fbd.25bbe5d1d695cc44a24a0a4515000949.svg 480w, \u002Fassets\u002Fstatic\u002Fhipscript.cbab2cf.25bbe5d1d695cc44a24a0a4515000949.svg 1024w, \u002Fassets\u002Fstatic\u002Fhipscript.a72e906.25bbe5d1d695cc44a24a0a4515000949.svg 1555w\" data-sizes=\"(max-width: 1555px) 100vw, 1555px\" data-src=\"\u002Fassets\u002Fstatic\u002Fhipscript.a72e906.25bbe5d1d695cc44a24a0a4515000949.svg\"\u003E\u003Cnoscript\u003E\u003Cimg class=\"g-image g-image--lazy g-image--loaded\" src=\"\u002Fassets\u002Fstatic\u002Fhipscript.a72e906.25bbe5d1d695cc44a24a0a4515000949.svg\" width=\"1555\" alt=\"foo\"\u003E\u003C\u002Fnoscript\u003E\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"dark-only\"\u003E\n\u003Cp\u003E\u003Cimg class=\"g-image g-image--lazy g-image--loading\" src=\"data:image\u002Fsvg+xml,%3csvg fill='none' viewBox='0 0 1555 404' xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg' xmlns:xlink='http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-b29a5aaa3afb700c1784b72fd5a80b0f'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'\u002F%3e%3c\u002Ffilter%3e%3c\u002Fdefs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-b29a5aaa3afb700c1784b72fd5a80b0f)' width='1555' height='404' xlink:href='data:image\u002Fsvg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAARCAYAAABtu6qMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAIzUlEQVRYw5VYWYwcZxHunWPn2rmvnumu6p57Zufc6WPn77F3ZhfjI74EcYwTx46NIjmyg7mCOYTCAzEQWZGAgCB2pMjE4CgGgWIH4kQYFCAKLyABQclDHnhEiDxECIkjavTPVtvtzSJCS%2bXp7vr7d9VXVV\u002FVv4IgCAIACJtdAJAFxCIAyIjYQsQKAOQQMQ0A%2bf\u002FyTRAA4iT%2bTfQ%2bACgiYhYR84hYQESR7wcAhQ1rvQAQA4AkAIQ36BIAkEHEFCJmAEB01gBABABqtKeH3mXID6C1We7LTefJsJkRAFgAABMB9RrWAyqWEiDJ3HldQaVUx6YPUakjYhcRF1VUY2WsBFRU4whYR8AhglJXQJHKWA2WsLygoppWUKkiKqyMlSA5xo2sAkAJET3cQHqXIiC5tW0A6PE15BgHwwSAOgCEAIDbBQRWmfR8nyUAaJLjGuk86\u002F7N9NzfhBsAHtVMSSkJMkh%2bFUvRIhTUvJzr56VsByrKQCrJLVHKDQsgDkQ5XxNEwZuTMwUR8s2snBbzcq6clTNSXs6VElIslZOzalZOY07O1nJyhutQlHNGUorFFVQy5ESDO42IMTIsShHqEDg8KBI5UKX1VQImQM6XCIA2gdYFgD45zp9HAKC6MjRP9wtuADhyMX7\u002F65W\u002FzN7d2TwSuqt1vHgfPBBfG%2b4drhh37DnWeDB1uH4ic6R5Mmuv2D57zfbZE9v\u002F5lZ7\u002Fu9Te\u002F71Lf%2bef2PrO\u002FM3Rm8G\u002Fza1\u002Ff9atf32%2b2y\u002Fvc2elcNF86XwtLqjkJXTcQVVnr5pKqnUzKD3eJG9OQIjR5EOki5FkebO%2b26WM4BK2TMk4AruDTnyEef5\u002Ft5D3heWX4vfPT6l7Lbu6ey37qtstw4Y26wPajvGBxu7xoeqq6N9\u002FSnbp%2b0ZHZY%2bbj4Svt88E3vQ\u002FMLCp41z4U%2bZjy6cND8fPWU%2bHPuo%2bcXYQ8aXo5\u002FQz0a\u002FMbwSvD5%2b\u002Faajq%2bWdgizLAiJymXPZ4w4Od65I2ZAgZ5JUGiKt8ZD4NgDlOL9IGcIvDvwtUkJEL6Vdrq40fUJQ8FwfvxH4tv6jdeJhgl8Yz8TH79vMzPaZVRuwcbPPxo0BGy\u002F2Z\u002FdWdcDG7QHbYvbZuNtnVr3HrFrPYtWONZJ7jBUK22qxv67YgZPdz4Xzck5FVAoUGfUWB8EcN5AbL0mSE22e5owcMTgfUfSjRLgDqvlFKp8OOVymchjSPden3QhJnIlJqSioiEUoSMOSmbo8ell%2b0nhevWTckL9r\u002FEy8ZNwoXDFeifPvDLZa0Nmq7EZ7he32mGwtorNpTWfTJYOtxu2OfVvqVpoN\u002FUDjqPTJ3iOBnJzNl7Dsl2V5zokeRXp%2bk5TPU0qnKKIFd5chQnT8UIkfeL2H6Zc\u002FLxBgYXr2Oe2kRQgnEbCWl3N5vczEx\u002FUr2pPmjwfnjaut88bV7nnj6vAJ47kZmewaHRI0NhU1NglpbBLU2CSusYmpsUlHY5OyxiaLGpuMNDZp8zVLy1uC23YcDFQXW7pVnrSNsiUWZFFFwEVKS50iJpGRSYos\u002F72TEyYiRkjntLYA6UWSaKfTEVw8wNtsnCRJLTNJnMNFduqrSahJCNjJSum0VZmIZ5fOK0%2bZ16sXjGvqBeNaY12ej9y1fGL2n2hsUtfYpKexiaGxyZhkhUTXrKmmsclQY5M%2bB0Rn056xc3vGvsf2LKrdJQ60gmqIWh9P03kyrEbRdGq\u002FRCBJ9MvTfZn0YQeQfr\u002FvzAB8\u002FZKLP3rkY5X2qDhEKrj6Ir8QAUvrGTCSL5ovxp4wnmuR1M8bV3vnzKcD\u002FOPJaK9XY5PcxlSljGhSJgQ26kuNqj4qrwyn1R3JtJSM4frM0abWlSQD29Tfh3TvrukKOdIk2\u002FMEWo6yIEF7LbvIMUzAhJxyIJ3I\u002F%2bHpEab6QgXVWEKKLZxonwldWr4RvaL\u002FKvd9\u002FdX8T\u002FTfx67or%2bTsge3lH5tsTeQ8QLXvJV5AnU27OpvWdTbVdDY1DLaaunf0EYGZ7\u002FceuOOkt9ZpDx5onUl9uP2xUF7OzgDkQxAnYjKqShFLU\u002FQbNNT0nTSnOl9w1X%2bE1vMUTyBiaAPz8ymWcx2fBIuuyTPlJpm4e9Nn2C\u002Fnn9Z\u002FGha2COGYlY1lmBwXLN%2bCyloJzvw9xip9Zi32mdXrWkzpshHM3lkW11V7jJVnHYAx7FqjQoeNcgM2FsVt1dir7M%2bRLw0vhJJSjE%2bHIh%2bLKYIO0eVdLRCJo5CDpKqqQACIlLVVGonnueMkEUQMIKKfOlz8NubfwK5zrkFhfVFKEE73H\u002FZcNl6O3Ts%2bLe22Dpf3WkdqO60P9XdZh7p3j0\u002FJH7CO1\u002FaMDnf2j462PmM%2blvim\u002FoPIY8al6Nf0ZyJf1S8vfF1\u002FNnJJvxF6Sn8h9D3t58EXtT\u002FO\u002F0Z7y\u002Ffs4BfBC%2ba1%2bP8YcuJO3yfiihGRZZwZwElhANhOdR5zkWbY1R5TdM\u002FL3Jk3bs0ZG0bh9RZXtmbvzhnf8RxvnE5\u002Ftng2sqrvtdb0fdpXUo8HDlaPJY6VTkXsoT0D762p7f3Tmu2199se%2b5DteWe77X17u%2b39w%2bo\u002FfK%2bt\u002FtP\u002F2%2bnb\u002Foujl4LfMn8Yvrrld6Gji6d8GTm1oKAap9YUIeFOhDYMMYFNxAGIR39MWeLwWJf4okXEXnbmC2f4ue3w5wIg4dREEQpzKpbmJZAwJScySTmekFVZl1CaFkBsxWEhIkJezkImGQDvfKjoD3Dh3JGSEtFoMRzmEi4GQpF1CQthYX3KmxPmilAsIioi4Mxhfh7QKcphF9FJFOEMRTFN0c\u002FT8zyB1nA7RODwq\u002Fiuk%2b0tXzcFwEOLKojI29BWANwyIylQyiBDAwEHCNhDUAoKqlHew\u002FkRma9HRK7v8zaKgLy\u002Ft2cnQ1R4Z2kgKjUFFQUR%2bSlzRQaJDz8KOcxBKMuy7CUuiDil%2bR7PBFnHhw06D6V72Jn73SP2u0BwLZhznQ\u002FoiIp1ACxRajUJ5ZDwf1yufRO0r3PCK1HU%2bbuMs15RlJsGbyauwMmuw0%2bZ9qoQwAUqF99mf\u002Fv4D3%2bgO6v6e2S\u002FAAAAAElFTkSuQmCC' \u002F%3e%3c\u002Fsvg%3e\" width=\"1555\" alt=\"foo\" data-srcset=\"\u002Fassets\u002Fstatic\u002Fhipscript.dark.82a2fbd.4b8b9933739c7717f269ee90e2eb2fff.svg 480w, \u002Fassets\u002Fstatic\u002Fhipscript.dark.cbab2cf.4b8b9933739c7717f269ee90e2eb2fff.svg 1024w, \u002Fassets\u002Fstatic\u002Fhipscript.dark.a72e906.4b8b9933739c7717f269ee90e2eb2fff.svg 1555w\" data-sizes=\"(max-width: 1555px) 100vw, 1555px\" data-src=\"\u002Fassets\u002Fstatic\u002Fhipscript.dark.a72e906.4b8b9933739c7717f269ee90e2eb2fff.svg\"\u003E\u003Cnoscript\u003E\u003Cimg class=\"g-image g-image--lazy g-image--loaded\" src=\"\u002Fassets\u002Fstatic\u002Fhipscript.dark.a72e906.4b8b9933739c7717f269ee90e2eb2fff.svg\" width=\"1555\" alt=\"foo\"\u003E\u003C\u002Fnoscript\u003E\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Ch1 id=\"what-is-hip-cuda\"\u003E\u003Ca href=\"#what-is-hip-cuda\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EWhat is HIP? CUDA?\u003C\u002Fh1\u003E\n\u003Cp\u003ECUDA is the name of the API developed by NVIDIA for GPGPU (General-purpose computing on graphics processing units). A CUDA compiler compiles the same C++ file twice: once for the GPU architecture, and once for the host. This way, you can share code between them, and all data types remain the same. CUDA also provides library functions for interacting with the GPU and special syntax for launching CUDA kernels.\u003C\u002Fp\u003E\n\u003Cp\u003ECUDA kernels are written for one thread, but are then executed by many. Several threads (of the programmer's choice) form a \"block\", which can share access to fast on-chip memory. There are then some number of blocks in a \"grid\".\u003C\u002Fp\u003E\n\u003Cp\u003EAMD came along and created HIP, their competitor to CUDA. It has identical syntax and concepts to CUDA—just pretty much does \u003Ccode class=\"language-text\"\u003Esed s\u002Fcuda\u002Fhip\u002Fg\u003C\u002Fcode\u003E! This allows projects like chipStar, which allows HIP code to run on any OpenCL-supported device, to provide a header file that \u003Ccode class=\"language-text\"\u003E#define\u003C\u002Fcode\u003Es CUDA calls into HIP ones.\u003C\u002Fp\u003E\n\u003Ch1 id=\"supported-hipcuda-features\"\u003E\u003Ca href=\"#supported-hipcuda-features\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ESupported HIP\u002FCUDA features\u003C\u002Fh1\u003E\n\u003Cp\u003EThis project currently supports a \u003Cstrong\u003Every basic\u003C\u002Fstrong\u003E subset of HIP and CUDA. However, the supported subset already provides a fair bit of material for learning GPU programming:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003EBasic kernel launch syntax\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EC++ is fully supported, so use generic kernels as you please! The compiler will analyze calls from the CPU side to determine what functions must be generated.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003EStatic and dynamic shared memory\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode class=\"language-text\"\u003E__syncthreads\u003C\u002Fcode\u003E (as long as it's in a uniform control flow path, i.e. no early returns or if statements based on \u003Ccode class=\"language-text\"\u003EthreadIdx\u003C\u002Fcode\u003E)\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode class=\"language-text\"\u003Eprintf\u003C\u002Fcode\u003E (format string and values are written to a hidden buffer by the GPU, then formatted by the CPU afterwards)\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode class=\"language-text\"\u003Eassert\u003C\u002Fcode\u003E (although Tint doesn't allow \u003Ccode class=\"language-text\"\u003E__syncthreads\u003C\u002Fcode\u003E afterwards due to \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgpuweb\u002Fgpuweb\u002Fissues\u002F3479#issuecomment-1467271026\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ean overzealous control-flow checker\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ccode class=\"language-text\"\u003EhipMalloc\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipFree\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipMemcpy\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipGetSymbolAddress\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipMemcpyToSymbol\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipLaunchKernel\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipLaunchKernelGGL\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipGetLastError\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipPeekAtLastError\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipGetErrorName\u003C\u002Fcode\u003E, \u003Ccode class=\"language-text\"\u003EhipGetErrorString\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Eand corresponding CUDA functions\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode class=\"language-text\"\u003E__device__\u003C\u002Fcode\u003E and \u003Ccode class=\"language-text\"\u003E__constant__\u003C\u002Fcode\u003E variables (although the latter are treated the same as the former, i.e. read-write)\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"unsupported-features\"\u003E\u003Ca href=\"#unsupported-features\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EUnsupported Features\u003C\u002Fh2\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003Eany functions not listed above\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Estreams\u003C\u002Fli\u003E\n\u003Cli\u003Egraphs\u003C\u002Fli\u003E\n\u003Cli\u003Emanaged\u002Fasynchronous memory transfers\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E64-bit floating point (WebGPU limitation) and 16-bit floating point (Tint limitation) numbers\u003C\u002Fli\u003E\n\u003Cli\u003Eintegers other than 32-bit signed and unsigned integers (WebGPU limitation)\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003Emany things with pointers:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Epassing a pointer to a kernel not directly as a parameter (e.g. in a struct)\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Cstrong\u003Epointer manipulation on the CPU side\u003C\u002Fstrong\u003E: note this means that you cannot pass an offset to \u003Ccode class=\"language-text\"\u003EhipMemcpy\u003C\u002Fcode\u003E or a kernel\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EWebGPU would allow a 128-byte aligned offset passed to a kernel. However, I decided not to implement that because of the limited 32-bit address space of WASM.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003Ewarp intrinsics (should be possible, although currently requires experimental Chrome flags)\u003C\u002Fli\u003E\n\u003Cli\u003Edynamic parallelism (could be polyfilled by converting calls to writes in a buffer, then launching kernels from the CPU)\u003C\u002Fli\u003E\n\u003Cli\u003Eany GPU libraries: cuDNN, cuBLAS, cuRAND, ...\u003C\u002Fli\u003E\n\u003Cli\u003ECooperative Groups\u003C\u002Fli\u003E\n\u003Cli\u003EInline PTX (\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FCHIP-SPV\u002FchipStar\u002Fdiscussions\u002F904#discussioncomment-10255598\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ealthough it has been done before\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch1 id=\"how-its-built\"\u003E\u003Ca href=\"#how-its-built\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EHow it's built\u003C\u002Fh1\u003E\n\u003Cp\u003EUsing LLVM compiled to WebAssembly, the input source code is first passed through Clang, which already understands HIP and CUDA. These languages are compiled in two passes—for the GPU using SPIR-V and for the CPU using WebAssembly. These use WebAssembly headers, meaning all types are the same size. Then, the GPU side code is fed through chipStar, a HIP-to-OpenCL translator. I keep its output as LLVM bitcode to immediately pass through Clspv, converting it to a Vulkan shader. Finally, Google's Tint from the Dawn project translates it to WGSL. A WebAssembly implementation of the HIP API then coordinates kernel launches.\u003C\u002Fp\u003E\n\u003Cp\u003EI aimed to keep file size in mind. To package as large of a project LLVM is, I wanted to make sure I wasn't duplicating any code—for example, the WASM backend code shouldn't exist separately in the compiler and linker. This is traditionally done with dynamic linking, which isn't supported by Wasmer (it is by Emscripten, but by going through a JS intermediate: slow). Thankfully, LLVM has an option just for this case: \u003Ccode class=\"language-text\"\u003ELLVM_TOOL_LLVM_DRIVER_BUILD\u003C\u002Fcode\u003E. By setting this flag, LLVM creates a single entrypoint that statically links to every executable. This way, you can just pass the desired tool as arg0 or arg1, like \u003Ccode class=\"language-text\"\u003Ellvm clang++ file.cpp\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EI then bundled the chipStar LLVM passes in the LLVM source code. I added a command-line flag that allows Clang to run the passes. Typically they're run with \u003Ccode class=\"language-text\"\u003Eopt\u003C\u002Fcode\u003E, but that isn't compatible with the driver. Clspv and SPIRV-Tools were added as \u003Ccode class=\"language-text\"\u003ELLVM_EXTERNAL_PROJECTS\u003C\u002Fcode\u003E to be additionally integrated in the single tool.\u003C\u002Fp\u003E\n\u003Ch1 id=\"issues-i-encountered\"\u003E\u003Ca href=\"#issues-i-encountered\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EIssues I encountered\u003C\u002Fh1\u003E\n\u003Ch2 id=\"wasmer-runtime-workarounds\"\u003E\u003Ca href=\"#wasmer-runtime-workarounds\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EWasmer Runtime Workarounds\u003C\u002Fh2\u003E\n\u003Cp\u003EI compiled LLVM using the WASIX toolchain, because it offers much needed functions not available in vanilla WASI, and Emscripten doesn't feel great for porting traditional command-line applications. However, the Wasmer SDK is the only implementation of the WASIX specification, and the JS version has some bugs. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwasmerio\u002Fwasmer-js\u002Fissues\u002F407\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EYou can't load a WASM file directly\u003C\u002Fa\u003E, loading their \"webc\" container directly just failed with a generic \u003Ccode class=\"language-text\"\u003EUnreachable\u003C\u002Fcode\u003E error, and the recommended Wasmer CDN doesn't compress files—even when a 5x compression ratio is possible. This large file size then causes Chrome to not cache anything at all! So, I set the \"API endpoint\" of the CDN to a simple \u003Ccode class=\"language-text\"\u003Efile:\u003C\u002Fcode\u003E URI that points to a \u003Ccode class=\"language-text\"\u003Eblob:\u003C\u002Fcode\u003E URI for the actual WASM file. On the page load, I handle downloading and caching the binary manually.\u003C\u002Fp\u003E\n\u003Cp\u003EThen, I was running into issues where I'd get another generic \u003Ccode class=\"language-text\"\u003EUnreachable\u003C\u002Fcode\u003E after launching more than a couple programs. I worked around this by just spawning new Web Workers and completely re-loading the SDK in each. Very thankfully, it seems like Chrome caches \u003Ccode class=\"language-text\"\u003EWebAssembly.compile\u003C\u002Fcode\u003E calls with the same binary input so there isn't too much of a performance penalty.\u003C\u002Fp\u003E\n\u003Cp\u003EI couldn't debug these issues because \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fwasmerio\u002Fwasmer-js\u002Fissues\u002F437\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ethe Wasmer SDK source is currently unable to be built\u003C\u002Fa\u003E and the package on NPM doesn't ship with debug symbols.\u003C\u002Fp\u003E\n\u003Ch2 id=\"compressed-data-on-cloudflare-r2\"\u003E\u003Ca href=\"#compressed-data-on-cloudflare-r2\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ECompressed Data on Cloudflare R2\u003C\u002Fh2\u003E\n\u003Cp\u003EGZip compression brought by LLVM bundle from 75MB to 21MB, and Brotli further to 15MB. I decided to use Brotli because of these savings, and it's supported on all modern browsers. I decided to use Cloudflare R2 as my storage provider, on which \u003Ca href=\"https:\u002F\u002Falexi.sh\u002Fblog\u002F2023\u002F03\u002Fusing-r2-to-store-and-serve-compressed-content\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Eothers have had success uploading pre-compressed data to\u003C\u002Fa\u003E since it won't compress to Brotli for you. However, I was encountering issues with the upload step, since rclone was detecting an incorrectly-sized upload. Turns out, you need to specify \u003Ccode class=\"language-text\"\u003ECache-Control: no-transform\u003C\u002Fcode\u003E. That has the bonus of correctly supporting custom domains with R2 (strongly encouraged for production), since it tells Cloudflare not to uncompress the data, bypassing the entire purpose of doing this.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"text\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"\u003E\u003Ccode class=\"language-text\"\u003Erclone copyto --progress --header-upload \"Content-Type: application\u002Foctet-stream\" --header-upload \"Content-Encoding: br\" --header-upload \"Cache-Control: no-transform\" $file $connection:$bucket\u002F$serverpath\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EBefore I discovered that, I used gdb to set a breakpoint on \u003Ccode class=\"language-text\"\u003Egithub.com\u002Frclone\u002Frclone\u002Ffs\u002Foperations.(*copy).removeFailedCopy\u003C\u002Fcode\u003E to stop deleting the (sucessfully, but it didn't know that) uploaded file.\u003C\u002Fp\u003E\n","path":"\u002Fblog\u002F2025\u002F01\u002F07\u002Fhip-script\u002F","headings":[{"depth":1,"value":"What is HIP? CUDA?","anchor":"#what-is-hip-cuda"},{"depth":1,"value":"Supported HIP\u002FCUDA features","anchor":"#supported-hipcuda-features"},{"depth":2,"value":"Unsupported Features","anchor":"#unsupported-features"},{"depth":1,"value":"How it's built","anchor":"#how-its-built"},{"depth":1,"value":"Issues I encountered","anchor":"#issues-i-encountered"},{"depth":2,"value":"Wasmer Runtime Workarounds","anchor":"#wasmer-runtime-workarounds"},{"depth":2,"value":"Compressed Data on Cloudflare R2","anchor":"#compressed-data-on-cloudflare-r2"}],"date":"January 7, 2025","rawDate":"2025-01-07T00:00:00.000Z","updated":null,"rawUpdated":null,"timeToRead":5}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.c4c6030a.js" defer></script><script src="/assets/js/page--src--templates--post-vue.b0ef1359.js" defer></script>
  </body>
</html>
